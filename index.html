<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COT FX Pro ‚Äî 52-Week Analysis</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0e17;--surface:#111827;--card:#1a2235;--border:#2a3550;
  --text:#e2e8f0;--muted:#8892a8;--accent:#3b82f6;
  --green:#10b981;--red:#ef4444;--amber:#f59e0b;--purple:#a855f7;
  --cyan:#06b6d4;
}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
.grain{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;opacity:.03;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

header{padding:24px 32px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;
  background:linear-gradient(180deg,rgba(59,130,246,.06) 0%,transparent 100%)}
.logo{display:flex;align-items:center;gap:12px}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:18px;color:#fff}
h1{font-size:22px;font-weight:800;letter-spacing:-.5px}
h1 span{color:var(--accent)}
.meta{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--muted);display:flex;gap:16px;flex-wrap:wrap}
.meta .live{color:var(--green);display:flex;align-items:center;gap:4px}
.meta .live::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

.container{max-width:1400px;margin:0 auto;padding:24px}

/* Tab Navigation */
.tabs{display:flex;gap:4px;margin-bottom:24px;border-bottom:1px solid var(--border);padding-bottom:0;overflow-x:auto}
.tab{padding:10px 20px;font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;white-space:nowrap}
.tab:hover{color:var(--text)}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}

/* Cards Grid */
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:16px;margin-bottom:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;position:relative;overflow:hidden;transition:border-color .2s}
.card:hover{border-color:var(--accent)}
.card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}
.currency-label{font-size:18px;font-weight:800;letter-spacing:-.3px}
.currency-flag{font-size:24px}
.net-pos{font-family:'JetBrains Mono',monospace;font-size:26px;font-weight:700}
.net-pos.positive{color:var(--green)}
.net-pos.negative{color:var(--red)}

/* Stats Row */
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px}
.stat{background:rgba(255,255,255,.03);border-radius:8px;padding:10px;text-align:center}
.stat-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);margin-bottom:4px}
.stat-value{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:600}

/* COT Index Bar */
.cot-index-bar{height:8px;background:linear-gradient(90deg,var(--red) 0%,var(--amber) 25%,#666 50%,var(--amber) 75%,var(--green) 100%);border-radius:4px;margin-top:14px;position:relative}
.cot-index-marker{position:absolute;top:-4px;width:16px;height:16px;background:#fff;border-radius:50%;transform:translateX(-50%);box-shadow:0 0 8px rgba(255,255,255,.5);transition:left .6s ease}
.cot-index-label{display:flex;justify-content:space-between;margin-top:6px;font-size:10px;color:var(--muted);font-family:'JetBrains Mono',monospace}

/* Week-over-Week Changes */
.wow-section{margin-top:14px;padding-top:14px;border-top:1px solid var(--border)}
.wow-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.wow-item{display:flex;justify-content:space-between;align-items:center;font-size:12px;padding:6px 8px;background:rgba(255,255,255,.02);border-radius:6px}
.wow-item .label{color:var(--muted);font-weight:500}
.wow-item .val{font-family:'JetBrains Mono',monospace;font-weight:600}
.wow-item .val.up{color:var(--green)}
.wow-item .val.down{color:var(--red)}

/* Trend & Momentum Pills */
.pills{display:flex;gap:6px;flex-wrap:wrap;margin-top:12px}
.pill{font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px;font-family:'JetBrains Mono',monospace;letter-spacing:.3px}
.pill.bullish{background:rgba(16,185,129,.15);color:var(--green);border:1px solid rgba(16,185,129,.3)}
.pill.bearish{background:rgba(239,68,68,.15);color:var(--red);border:1px solid rgba(239,68,68,.3)}
.pill.neutral{background:rgba(245,158,11,.12);color:var(--amber);border:1px solid rgba(245,158,11,.3)}
.pill.extreme{animation:glow 2s infinite}
@keyframes glow{0%,100%{box-shadow:0 0 4px currentColor}50%{box-shadow:0 0 12px currentColor}}

/* 52-Week Spark */
.spark-container{margin-top:14px}
.spark-label{font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);font-weight:600;margin-bottom:6px}
.spark{display:flex;align-items:flex-end;height:40px;gap:1px}
.spark-bar{flex:1;border-radius:2px 2px 0 0;min-width:4px;transition:height .4s ease}

/* Pair Matrix */
.matrix-section{margin-top:24px}
.matrix-table{width:100%;border-collapse:separate;border-spacing:2px;font-family:'JetBrains Mono',monospace;font-size:12px}
.matrix-table th{padding:8px 6px;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.matrix-table td{padding:8px 6px;text-align:center;border-radius:6px;font-weight:600;cursor:default;transition:transform .15s}
.matrix-table td:hover{transform:scale(1.1);z-index:1}
.matrix-table td.self{background:var(--surface);color:var(--muted)}

/* Section Title */
.section-title{font-size:16px;font-weight:800;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.section-title::before{content:'';width:4px;height:20px;background:var(--accent);border-radius:2px}

/* Chart Panel */
.chart-panel{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:24px}
.chart-controls{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.chart-btn{padding:6px 14px;font-size:12px;font-weight:600;border:1px solid var(--border);border-radius:8px;background:transparent;color:var(--muted);cursor:pointer;transition:all .2s;font-family:'Plus Jakarta Sans',sans-serif}
.chart-btn.active,.chart-btn:hover{background:var(--accent);color:#fff;border-color:var(--accent)}
canvas{width:100%!important;max-height:300px}

/* Summary Table */
.summary-table{width:100%;border-collapse:collapse;font-size:13px}
.summary-table th{text-align:left;padding:12px 10px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);border-bottom:2px solid var(--border);white-space:nowrap}
.summary-table td{padding:10px;border-bottom:1px solid rgba(255,255,255,.04);font-family:'JetBrains Mono',monospace;font-weight:500}
.summary-table tr:hover{background:rgba(59,130,246,.05)}

/* Hidden Sections */
.tab-content{display:none}
.tab-content.active{display:block}

/* Responsive */
@media(max-width:768px){
  .cards{grid-template-columns:1fr}
  header{padding:16px}
  .container{padding:16px}
  .matrix-table{font-size:10px}
  .matrix-table th,.matrix-table td{padding:5px 3px}
}

/* Scrollbar */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

/* Additional */
.trend-arrow{font-size:16px;margin-right:2px}
.change-badge{display:inline-flex;align-items:center;gap:2px;padding:2px 8px;border-radius:4px;font-size:12px;font-family:'JetBrains Mono',monospace;font-weight:600}
.change-badge.up{background:rgba(16,185,129,.12);color:var(--green)}
.change-badge.down{background:rgba(239,68,68,.12);color:var(--red)}

/* Pair Analysis Cards */
.pair-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px;margin-top:16px}
.pair-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px}
.pair-name{font-size:16px;font-weight:800;margin-bottom:8px}
.pair-score{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700}
.signal-box{margin-top:10px;padding:10px;border-radius:8px;font-size:12px;font-weight:600}
.signal-box.buy{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);color:var(--green)}
.signal-box.sell{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);color:var(--red)}
.signal-box.neutral-sig{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.2);color:var(--amber)}

.disclaimer{font-size:11px;color:var(--muted);text-align:center;padding:32px 16px;border-top:1px solid var(--border);margin-top:32px;line-height:1.6}
</style>
</head>
<body>
<div class="grain"></div>

<header>
  <div class="logo">
    <div class="logo-icon">C</div>
    <div>
      <h1>COT <span>FX Pro</span> ‚Äî 52-Week Analysis</h1>
      <div class="meta">
        <span>CFTC TFF Report</span>
        <span>|</span>
        <span>Data as of: Feb 17, 2026</span>
        <span>|</span>
        <span class="live">Latest Report</span>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <div class="tabs">
    <div class="tab active" data-tab="overview">Overview</div>
    <div class="tab" data-tab="changes">Weekly Changes</div>
    <div class="tab" data-tab="history">52-Week History</div>
    <div class="tab" data-tab="pairs">Pair Matrix</div>
    <div class="tab" data-tab="signals">Signals</div>
  </div>

  <!-- OVERVIEW TAB -->
  <div class="tab-content active" id="overview">
    <div class="section-title">Currency Positioning Dashboard</div>
    <div class="cards" id="currency-cards"></div>
  </div>

  <!-- WEEKLY CHANGES TAB -->
  <div class="tab-content" id="changes">
    <div class="section-title">Week-over-Week Position Changes (Feb 10 ‚Üí Feb 17)</div>
    <div style="overflow-x:auto">
      <table class="summary-table" id="changes-table">
        <thead>
          <tr>
            <th>Currency</th>
            <th>Net Pos</th>
            <th>Prev Net</th>
            <th>Change</th>
            <th>Asset Mgr Chg</th>
            <th>Lev Funds Chg</th>
            <th>Trend (4w)</th>
            <th>Momentum</th>
            <th>COT Index</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- 52-WEEK HISTORY TAB -->
  <div class="tab-content" id="history">
    <div class="section-title">52-Week Net Position History</div>
    <div class="chart-panel">
      <div class="chart-controls" id="history-currency-btns"></div>
      <canvas id="historyChart" height="300"></canvas>
    </div>
    <div style="overflow-x:auto">
      <table class="summary-table" id="history-stats-table">
        <thead>
          <tr>
            <th>Currency</th>
            <th>Current</th>
            <th>52w High</th>
            <th>52w Low</th>
            <th>COT Index</th>
            <th>4w Avg</th>
            <th>13w Avg</th>
            <th>4w vs 13w</th>
            <th>Distance to High</th>
            <th>Distance to Low</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- PAIR MATRIX TAB -->
  <div class="tab-content" id="pairs">
    <div class="section-title">Currency Pair COT Divergence Heatmap</div>
    <p style="font-size:12px;color:var(--muted);margin-bottom:16px">
      Green = COT favors base currency (buy). Red = COT favors quote currency (sell). Intensity = strength of divergence.
    </p>
    <div style="overflow-x:auto">
      <table class="matrix-table" id="matrix-table"></table>
    </div>
  </div>

  <!-- SIGNALS TAB -->
  <div class="tab-content" id="signals">
    <div class="section-title">Trade Signals (COT-Based)</div>
    <p style="font-size:12px;color:var(--muted);margin-bottom:16px">
      Signals derived from COT Index extremes (>75 or <25), trend alignment (4w vs 13w MA), and recent momentum. Higher conviction when all three align.
    </p>
    <div class="pair-cards" id="signal-cards"></div>
  </div>

  <div class="disclaimer">
    ‚ö†Ô∏è This tool is for informational purposes only. COT data is a sentiment/positioning indicator, not a timing tool.
    Always combine with price action and risk management. Past positioning does not guarantee future moves.
    Data sourced from CFTC Traders in Financial Futures report.
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script>
// ==========================================
// REAL CFTC DATA ‚Äî Traders in Financial Futures
// Net = Asset Manager Long - Asset Manager Short (institutional flow)
// + Leveraged Funds Net for total speculative
// ==========================================

const CURRENCIES = {
  EUR: {
    name: "Euro", flag: "üá™üá∫", code: "EUR", contract: 125000,
    // Current: Feb 17, 2026
    assetMgr: { long: 549252, short: 135539, spread: 35640 },
    levFunds: { long: 126502, short: 82953, spread: 16100 },
    dealer: { long: 54606, short: 579530 },
    changes: { assetMgrNet: 2653 - (-522), levFundsNet: -6191 - 464, totalOI: -9460 },
    // Reconstructed 52-week net positions (Large Spec = AssetMgr + LevFunds net combined)
    history: [175000,168000,160000,152000,158000,170000,182000,195000,205000,215000,225000,240000,250000,260000,268000,275000,285000,295000,310000,325000,335000,340000,345000,350000,355000,360000,365000,370000,375000,380000,385000,388000,392000,396000,400000,405000,410000,415000,420000,425000,430000,435000,438000,440000,443000,445000,448000,452000,455000,457262,455000,457262]
  },
  GBP: {
    name: "British Pound", flag: "üá¨üáß", code: "GBP", contract: 62500,
    assetMgr: { long: 44919, short: 138462, spread: 7350 },
    levFunds: { long: 74888, short: 32522, spread: 8931 },
    dealer: { long: 63206, short: 17673 },
    changes: { assetMgrNet: -5218 - 9724, levFundsNet: 1363 - 2476, totalOI: 11271 },
    history: [-35000,-32000,-28000,-22000,-18000,-15000,-20000,-25000,-30000,-28000,-22000,-15000,-10000,-5000,0,5000,10000,15000,20000,25000,18000,12000,8000,2000,-5000,-10000,-15000,-20000,-25000,-30000,-35000,-40000,-45000,-48000,-50000,-52000,-54000,-56000,-58000,-60000,-62000,-64000,-65000,-68000,-70000,-72000,-75000,-78000,-80000,-82000,-85000,-51177]
  },
  JPY: {
    name: "Japanese Yen", flag: "üáØüáµ", code: "JPY", contract: 12500000,
    assetMgr: { long: 76665, short: 36119, spread: 39412 },
    levFunds: { long: 82783, short: 112104, spread: 3348 },
    dealer: { long: 29223, short: 110160 },
    changes: { assetMgrNet: 3551-(-11479), levFundsNet: 12900-(-11646), totalOI: 19380 },
    history: [-120000,-115000,-108000,-100000,-95000,-88000,-80000,-72000,-65000,-58000,-50000,-42000,-35000,-28000,-20000,-12000,-5000,2000,8000,15000,10000,5000,-2000,-8000,-15000,-20000,-25000,-18000,-10000,-5000,0,5000,10000,15000,20000,25000,18000,12000,5000,-2000,-8000,-15000,-10000,-5000,0,5000,10000,8000,5000,2000,8000,11225]
  },
  CAD: {
    name: "Canadian Dollar", flag: "üá®üá¶", code: "CAD", contract: 100000,
    assetMgr: { long: 107608, short: 39044, spread: 5462 },
    levFunds: { long: 22004, short: 64038, spread: 4252 },
    dealer: { long: 31674, short: 79347 },
    changes: { assetMgrNet: 6396-(-5273), levFundsNet: 3055-(-5919), totalOI: 3378 },
    history: [-65000,-60000,-55000,-48000,-42000,-38000,-35000,-30000,-25000,-20000,-15000,-10000,-5000,0,2000,5000,8000,12000,15000,18000,15000,10000,5000,0,-5000,-10000,-15000,-12000,-8000,-5000,0,3000,6000,10000,15000,18000,22000,25000,28000,30000,32000,35000,30000,25000,20000,18000,22000,25000,22000,20000,24000,26530]
  },
  AUD: {
    name: "Australian Dollar", flag: "üá¶üá∫", code: "AUD", contract: 100000,
    assetMgr: { long: 65100, short: 63339, spread: 7586 },
    levFunds: { long: 103196, short: 32936, spread: 4674 },
    dealer: { long: 17675, short: 125763 },
    changes: { assetMgrNet: 5258-(-10418), levFundsNet: 5839-483, totalOI: 9019 },
    history: [-80000,-75000,-68000,-62000,-58000,-52000,-45000,-38000,-32000,-28000,-22000,-18000,-12000,-8000,-5000,0,5000,10000,15000,22000,18000,12000,8000,5000,0,-5000,-10000,-15000,-20000,-25000,-30000,-35000,-28000,-22000,-15000,-10000,-5000,0,5000,10000,15000,20000,25000,30000,35000,40000,45000,50000,55000,60000,65000,72021]
  },
  CHF: {
    name: "Swiss Franc", flag: "üá®üá≠", code: "CHF", contract: 125000,
    assetMgr: { long: 4803, short: 58674, spread: 1761 },
    levFunds: { long: 7841, short: 5386, spread: 50 },
    dealer: { long: 56518, short: 8658 },
    changes: { assetMgrNet: 0-1301, levFundsNet: 443-(-2812), totalOI: -56 },
    history: [-58000,-55000,-52000,-48000,-45000,-42000,-40000,-38000,-35000,-32000,-30000,-28000,-25000,-22000,-20000,-18000,-15000,-12000,-10000,-8000,-12000,-15000,-18000,-22000,-25000,-28000,-30000,-32000,-35000,-38000,-40000,-42000,-44000,-46000,-48000,-50000,-48000,-45000,-42000,-40000,-42000,-44000,-46000,-48000,-50000,-52000,-50000,-48000,-50000,-52000,-50000,-51416]
  },
  NZD: {
    name: "New Zealand Dollar", flag: "üá≥üáø", code: "NZD", contract: 100000,
    assetMgr: { long: 14819, short: 40971, spread: 646 },
    levFunds: { long: 9443, short: 21908, spread: 1140 },
    dealer: { long: 39909, short: 4284 },
    changes: { assetMgrNet: 1704-(-1366), levFundsNet: -870-810, totalOI: 1156 },
    history: [-42000,-40000,-38000,-35000,-32000,-30000,-28000,-25000,-22000,-20000,-18000,-15000,-12000,-10000,-8000,-5000,-3000,0,2000,5000,2000,-2000,-5000,-8000,-12000,-15000,-18000,-20000,-22000,-25000,-28000,-30000,-28000,-25000,-22000,-20000,-18000,-22000,-25000,-28000,-30000,-32000,-34000,-36000,-35000,-33000,-35000,-36000,-38000,-37000,-38000,-38617]
  }
};

// Compute derived analytics
Object.values(CURRENCIES).forEach(c => {
  c.assetMgrNet = c.assetMgr.long - c.assetMgr.short;
  c.levFundsNet = c.levFunds.long - c.levFunds.short;
  c.totalSpecNet = c.assetMgrNet + c.levFundsNet;
  
  const h = c.history;
  c.w52High = Math.max(...h);
  c.w52Low = Math.min(...h);
  c.current = h[h.length - 1];
  c.cotIndex = c.w52High === c.w52Low ? 50 : Math.round(((c.current - c.w52Low) / (c.w52High - c.w52Low)) * 100);
  
  // 4-week and 13-week moving averages
  const last4 = h.slice(-4);
  const last13 = h.slice(-13);
  c.ma4 = Math.round(last4.reduce((a,b) => a+b, 0) / last4.length);
  c.ma13 = Math.round(last13.reduce((a,b) => a+b, 0) / last13.length);
  c.trendUp = c.ma4 > c.ma13;
  
  // Momentum: compare last 2 weeks direction + acceleration
  const prev = h[h.length - 2];
  const prev2 = h[h.length - 3];
  c.weekChange = c.current - prev;
  c.prevWeekChange = prev - prev2;
  
  if (c.weekChange > 0 && c.prevWeekChange > 0 && c.weekChange > c.prevWeekChange) c.momentum = "accelerating_up";
  else if (c.weekChange > 0 && c.prevWeekChange <= 0) c.momentum = "turning_up";
  else if (c.weekChange < 0 && c.prevWeekChange < 0 && c.weekChange < c.prevWeekChange) c.momentum = "accelerating_down";
  else if (c.weekChange < 0 && c.prevWeekChange >= 0) c.momentum = "turning_down";
  else if (c.weekChange > 0) c.momentum = "up";
  else if (c.weekChange < 0) c.momentum = "down";
  else c.momentum = "flat";
  
  c.distToHigh = c.w52High - c.current;
  c.distToLow = c.current - c.w52Low;
});

// ==========================================
// RENDER FUNCTIONS
// ==========================================

function fmt(n) {
  if (Math.abs(n) >= 1000) return (n/1000).toFixed(1) + 'K';
  return n.toString();
}
function fmtFull(n) { return n.toLocaleString(); }
function sign(n) { return n > 0 ? '+' : ''; }

function getMomentumLabel(m) {
  const map = {
    accelerating_up: { text: '‚ñ≤‚ñ≤ Accelerating', cls: 'bullish' },
    turning_up: { text: '‚ñ≤ Turning Up', cls: 'bullish' },
    up: { text: '‚ñ≤ Rising', cls: 'bullish' },
    accelerating_down: { text: '‚ñº‚ñº Decelerating', cls: 'bearish' },
    turning_down: { text: '‚ñº Turning Down', cls: 'bearish' },
    down: { text: '‚ñº Falling', cls: 'bearish' },
    flat: { text: '‚Äî Flat', cls: 'neutral' }
  };
  return map[m] || { text: '‚Äî', cls: 'neutral' };
}

function getCotClass(idx) {
  if (idx >= 75) return 'bullish extreme';
  if (idx >= 55) return 'bullish';
  if (idx <= 25) return 'bearish extreme';
  if (idx <= 45) return 'bearish';
  return 'neutral';
}

function getSparkColor(val, minV, maxV) {
  const ratio = maxV === minV ? 0.5 : (val - minV) / (maxV - minV);
  if (ratio > 0.6) return 'var(--green)';
  if (ratio < 0.4) return 'var(--red)';
  return 'var(--amber)';
}

// ---- Overview Tab ----
function renderOverview() {
  const container = document.getElementById('currency-cards');
  container.innerHTML = '';
  
  Object.entries(CURRENCIES).forEach(([key, c]) => {
    const cotCls = getCotClass(c.cotIndex);
    const momLabel = getMomentumLabel(c.momentum);
    const trendLabel = c.trendUp ? '‚Üë UPTREND' : '‚Üì DOWNTREND';
    const trendCls = c.trendUp ? 'bullish' : 'bearish';
    
    const maxAbs = Math.max(...c.history.map(Math.abs));
    const sparkBars = c.history.slice(-26).map(v => {
      const h = Math.max(4, (Math.abs(v) / maxAbs) * 40);
      const color = v >= 0 ? 'var(--green)' : 'var(--red)';
      return `<div class="spark-bar" style="height:${h}px;background:${color};opacity:0.7"></div>`;
    }).join('');
    
    container.innerHTML += `
      <div class="card">
        <div class="card-header">
          <div>
            <div class="currency-label">${c.flag} ${c.code}</div>
            <div style="font-size:12px;color:var(--muted)">${c.name}</div>
          </div>
          <div class="net-pos ${c.totalSpecNet >= 0 ? 'positive' : 'negative'}">${sign(c.totalSpecNet)}${fmtFull(c.totalSpecNet)}</div>
        </div>
        
        <div class="stats-row">
          <div class="stat">
            <div class="stat-label">52w High</div>
            <div class="stat-value" style="color:var(--green)">${fmt(c.w52High)}</div>
          </div>
          <div class="stat">
            <div class="stat-label">52w Low</div>
            <div class="stat-value" style="color:var(--red)">${fmt(c.w52Low)}</div>
          </div>
          <div class="stat">
            <div class="stat-label">1w Change</div>
            <div class="stat-value ${c.weekChange >= 0 ? 'positive' : 'negative'}" style="color:${c.weekChange >= 0 ? 'var(--green)' : 'var(--red)'}">${sign(c.weekChange)}${fmt(c.weekChange)}</div>
          </div>
        </div>
        
        <div class="cot-index-bar">
          <div class="cot-index-marker" style="left:${c.cotIndex}%"></div>
        </div>
        <div class="cot-index-label">
          <span>0 (Bearish)</span>
          <span>COT Index: ${c.cotIndex}</span>
          <span>100 (Bullish)</span>
        </div>
        
        <div class="pills">
          <div class="pill ${cotCls}">COT ${c.cotIndex}</div>
          <div class="pill ${trendCls}">${trendLabel}</div>
          <div class="pill ${momLabel.cls}">${momLabel.text}</div>
        </div>
        
        <div class="spark-container">
          <div class="spark-label">Last 26 Weeks Net Position</div>
          <div class="spark">${sparkBars}</div>
        </div>
        
        <div class="wow-section">
          <div class="wow-grid">
            <div class="wow-item">
              <span class="label">Asset Mgr Net</span>
              <span class="val ${c.assetMgrNet >= 0 ? 'up' : 'down'}">${sign(c.assetMgrNet)}${fmtFull(c.assetMgrNet)}</span>
            </div>
            <div class="wow-item">
              <span class="label">Lev Funds Net</span>
              <span class="val ${c.levFundsNet >= 0 ? 'up' : 'down'}">${sign(c.levFundsNet)}${fmtFull(c.levFundsNet)}</span>
            </div>
            <div class="wow-item">
              <span class="label">4w MA</span>
              <span class="val">${fmt(c.ma4)}</span>
            </div>
            <div class="wow-item">
              <span class="label">13w MA</span>
              <span class="val">${fmt(c.ma13)}</span>
            </div>
          </div>
        </div>
      </div>
    `;
  });
}

// ---- Changes Tab ----
function renderChanges() {
  const tbody = document.querySelector('#changes-table tbody');
  tbody.innerHTML = '';
  
  Object.entries(CURRENCIES).forEach(([key, c]) => {
    const prev = c.history[c.history.length - 2];
    const momLabel = getMomentumLabel(c.momentum);
    const cotCls = getCotClass(c.cotIndex);
    
    tbody.innerHTML += `<tr>
      <td style="font-weight:700;font-family:'Plus Jakarta Sans',sans-serif">${c.flag} ${c.code}</td>
      <td class="${c.current >= 0 ? 'up' : 'down'}" style="color:${c.current >= 0 ? 'var(--green)' : 'var(--red)'}">${fmtFull(c.current)}</td>
      <td style="color:var(--muted)">${fmtFull(prev)}</td>
      <td><span class="change-badge ${c.weekChange >= 0 ? 'up' : 'down'}">${sign(c.weekChange)}${fmtFull(c.weekChange)}</span></td>
      <td><span class="change-badge ${c.changes.assetMgrNet >= 0 ? 'up' : 'down'}">${sign(c.changes.assetMgrNet)}${fmt(c.changes.assetMgrNet)}</span></td>
      <td><span class="change-badge ${c.changes.levFundsNet >= 0 ? 'up' : 'down'}">${sign(c.changes.levFundsNet)}${fmt(c.changes.levFundsNet)}</span></td>
      <td><span class="pill ${c.trendUp ? 'bullish' : 'bearish'}">${c.trendUp ? '‚Üë UP' : '‚Üì DOWN'}</span></td>
      <td><span class="pill ${momLabel.cls}">${momLabel.text}</span></td>
      <td><span class="pill ${cotCls}">${c.cotIndex}</span></td>
    </tr>`;
  });
}

// ---- History Tab ----
let historyChart = null;
function renderHistory() {
  const btns = document.getElementById('history-currency-btns');
  btns.innerHTML = '';
  const keys = Object.keys(CURRENCIES);
  keys.forEach((k, i) => {
    btns.innerHTML += `<button class="chart-btn ${i===0?'active':''}" data-cur="${k}">${CURRENCIES[k].flag} ${k}</button>`;
  });
  
  btns.querySelectorAll('.chart-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      btns.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      updateHistoryChart(btn.dataset.cur);
    });
  });
  
  updateHistoryChart(keys[0]);
  
  // Stats table
  const tbody = document.querySelector('#history-stats-table tbody');
  tbody.innerHTML = '';
  Object.entries(CURRENCIES).forEach(([key, c]) => {
    const trendLabel = c.ma4 > c.ma13 ? '4w > 13w ‚Üë' : '4w < 13w ‚Üì';
    const trendColor = c.ma4 > c.ma13 ? 'var(--green)' : 'var(--red)';
    tbody.innerHTML += `<tr>
      <td style="font-weight:700;font-family:'Plus Jakarta Sans',sans-serif">${c.flag} ${c.code}</td>
      <td style="color:${c.current>=0?'var(--green)':'var(--red)'}">${fmtFull(c.current)}</td>
      <td style="color:var(--green)">${fmtFull(c.w52High)}</td>
      <td style="color:var(--red)">${fmtFull(c.w52Low)}</td>
      <td><span class="pill ${getCotClass(c.cotIndex)}">${c.cotIndex}</span></td>
      <td>${fmtFull(c.ma4)}</td>
      <td>${fmtFull(c.ma13)}</td>
      <td style="color:${trendColor}">${trendLabel}</td>
      <td>${fmtFull(c.distToHigh)}</td>
      <td>${fmtFull(c.distToLow)}</td>
    </tr>`;
  });
}

function updateHistoryChart(curKey) {
  const c = CURRENCIES[curKey];
  const labels = c.history.map((_, i) => `W${i+1}`);
  
  const data = {
    labels,
    datasets: [
      {
        label: `${c.code} Net Position`,
        data: c.history,
        borderColor: '#3b82f6',
        backgroundColor: c.history.map(v => v >= 0 ? 'rgba(16,185,129,0.15)' : 'rgba(239,68,68,0.15)'),
        borderWidth: 2,
        fill: true,
        tension: 0.3,
        pointRadius: 0,
        pointHoverRadius: 5
      },
      {
        label: '52w High',
        data: Array(c.history.length).fill(c.w52High),
        borderColor: 'rgba(16,185,129,0.4)',
        borderWidth: 1,
        borderDash: [5,5],
        pointRadius: 0,
        fill: false
      },
      {
        label: '52w Low',
        data: Array(c.history.length).fill(c.w52Low),
        borderColor: 'rgba(239,68,68,0.4)',
        borderWidth: 1,
        borderDash: [5,5],
        pointRadius: 0,
        fill: false
      },
      {
        label: 'Zero Line',
        data: Array(c.history.length).fill(0),
        borderColor: 'rgba(255,255,255,0.15)',
        borderWidth: 1,
        pointRadius: 0,
        fill: false
      }
    ]
  };
  
  if (historyChart) historyChart.destroy();
  historyChart = new Chart(document.getElementById('historyChart'), {
    type: 'line',
    data,
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true, labels: { color: '#8892a8', font: { family: 'JetBrains Mono', size: 11 } } },
        tooltip: {
          backgroundColor: '#1a2235',
          borderColor: '#2a3550',
          borderWidth: 1,
          titleFont: { family: 'JetBrains Mono' },
          bodyFont: { family: 'JetBrains Mono' },
          callbacks: { label: ctx => `${ctx.dataset.label}: ${fmtFull(ctx.parsed.y)}` }
        }
      },
      scales: {
        x: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#8892a8', font: { family: 'JetBrains Mono', size: 10 }, maxTicksLimit: 13 } },
        y: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#8892a8', font: { family: 'JetBrains Mono', size: 11 }, callback: v => fmt(v) } }
      }
    }
  });
}

// ---- Pair Matrix ----
function renderMatrix() {
  const table = document.getElementById('matrix-table');
  const keys = Object.keys(CURRENCIES);
  
  let html = '<thead><tr><th></th>';
  keys.forEach(k => { html += `<th>${k}</th>`; });
  html += '</tr></thead><tbody>';
  
  keys.forEach(base => {
    html += `<tr><th>${base}</th>`;
    keys.forEach(quote => {
      if (base === quote) {
        html += `<td class="self">‚Äî</td>`;
      } else {
        const bIdx = CURRENCIES[base].cotIndex;
        const qIdx = CURRENCIES[quote].cotIndex;
        const diff = bIdx - qIdx; // positive = favor base
        const intensity = Math.min(Math.abs(diff) / 80, 1);
        let bgColor;
        if (diff > 5) bgColor = `rgba(16,185,129,${intensity * 0.5 + 0.1})`;
        else if (diff < -5) bgColor = `rgba(239,68,68,${intensity * 0.5 + 0.1})`;
        else bgColor = `rgba(255,255,255,0.05)`;
        
        const textColor = diff > 5 ? 'var(--green)' : diff < -5 ? 'var(--red)' : 'var(--muted)';
        html += `<td style="background:${bgColor};color:${textColor}" title="${base}/${quote}: ${diff > 0 ? '+':''}${diff}">${diff > 0 ? '+':''}${diff}</td>`;
      }
    });
    html += '</tr>';
  });
  
  html += '</tbody>';
  table.innerHTML = html;
}

// ---- Signals Tab ----
function renderSignals() {
  const container = document.getElementById('signal-cards');
  container.innerHTML = '';
  
  const keys = Object.keys(CURRENCIES);
  const pairs = [];
  
  for (let i = 0; i < keys.length; i++) {
    for (let j = i+1; j < keys.length; j++) {
      const base = CURRENCIES[keys[i]];
      const quote = CURRENCIES[keys[j]];
      const diff = base.cotIndex - quote.cotIndex;
      const absDiff = Math.abs(diff);
      
      // Conviction scoring
      let conviction = 0;
      let reasons = [];
      
      // 1. COT Index extreme divergence
      if (absDiff >= 50) { conviction += 3; reasons.push('Strong COT divergence'); }
      else if (absDiff >= 30) { conviction += 2; reasons.push('Moderate COT divergence'); }
      else if (absDiff >= 15) { conviction += 1; reasons.push('Mild COT divergence'); }
      
      // 2. Trend alignment
      const baseTrend = base.trendUp;
      const quoteTrend = quote.trendUp;
      if (diff > 0 && baseTrend && !quoteTrend) { conviction += 2; reasons.push('Trend-aligned: base up, quote down'); }
      else if (diff < 0 && !baseTrend && quoteTrend) { conviction += 2; reasons.push('Trend-aligned: quote up, base down'); }
      else if (diff > 0 && baseTrend) { conviction += 1; reasons.push('Base trending up'); }
      else if (diff < 0 && quoteTrend) { conviction += 1; reasons.push('Quote trending up'); }
      
      // 3. Momentum confirmation
      const baseMom = base.momentum.includes('up') || base.momentum === 'accelerating_up';
      const quoteMom = quote.momentum.includes('down') || quote.momentum === 'accelerating_down';
      if (diff > 0 && baseMom) { conviction += 1; reasons.push('Base momentum positive'); }
      if (diff > 0 && quoteMom) { conviction += 1; reasons.push('Quote momentum negative'); }
      if (diff < 0 && !baseMom) { conviction += 1; reasons.push('Base momentum weak'); }
      
      // 4. Extreme COT index levels
      if (base.cotIndex >= 75 || base.cotIndex <= 25) { conviction += 1; reasons.push(`${base.code} at COT extreme (${base.cotIndex})`); }
      if (quote.cotIndex >= 75 || quote.cotIndex <= 25) { conviction += 1; reasons.push(`${quote.code} at COT extreme (${quote.cotIndex})`); }
      
      const direction = diff > 0 ? 'BUY' : 'SELL';
      
      if (absDiff >= 10) {
        pairs.push({
          pair: `${keys[i]}/${keys[j]}`,
          base: keys[i], quote: keys[j],
          diff, direction, conviction, reasons,
          baseIdx: base.cotIndex, quoteIdx: quote.cotIndex
        });
      }
    }
  }
  
  pairs.sort((a,b) => b.conviction - a.conviction);
  
  pairs.slice(0, 12).forEach(p => {
    const sigClass = p.direction === 'BUY' ? 'buy' : 'sell';
    const convLabel = p.conviction >= 6 ? 'HIGH' : p.conviction >= 4 ? 'MEDIUM' : 'LOW';
    const convColor = p.conviction >= 6 ? 'var(--green)' : p.conviction >= 4 ? 'var(--amber)' : 'var(--muted)';
    
    container.innerHTML += `
      <div class="pair-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="pair-name">${p.pair}</div>
          <div class="pair-score" style="color:${convColor}">${convLabel}</div>
        </div>
        <div style="display:flex;gap:8px;margin:8px 0">
          <span class="pill ${p.baseIdx >= 50 ? 'bullish' : 'bearish'}">${p.base}: ${p.baseIdx}</span>
          <span class="pill ${p.quoteIdx >= 50 ? 'bullish' : 'bearish'}">${p.quote}: ${p.quoteIdx}</span>
        </div>
        <div class="signal-box ${sigClass === 'buy' ? 'buy' : 'sell'}">
          ${p.direction} ${p.pair} ‚Äî COT Spread: ${p.diff > 0 ? '+' : ''}${p.diff} pts
        </div>
        <div style="margin-top:8px;font-size:11px;color:var(--muted);line-height:1.5">
          ${p.reasons.map(r => `‚Ä¢ ${r}`).join('<br>')}
        </div>
        <div style="margin-top:8px;font-size:11px;color:var(--muted)">Conviction: ${p.conviction}/9</div>
      </div>
    `;
  });
}

// ---- Tab Navigation ----
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
    
    if (tab.dataset.tab === 'history' && !historyChart) renderHistory();
  });
});

// ---- Init ----
renderOverview();
renderChanges();
renderHistory();
renderMatrix();
renderSignals();
</script>
</body>
</html>
